<!--== Start Page Breadcrumb ==-->
<div class="page-breadcrumb-wrap" style="margin-top: -25px">
    <div class="container">
        <div class="row">
            <div class="col-lg-12">
                <div class="page-breadcrumb">
                    <ul class="nav">
                        <li><a href="index.php">首页</a></li>
                        <li><a href="my.php" class="active">个人中心</a></li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
</div>
<!--== End Page Breadcrumb ==-->

<!--== Page Content Wrapper Start ==-->
<div id="page-content-wrapper">
    <div class="container">
        <div class="row">
            <div class="col-lg-12">
                <!-- My Account Page Start -->
                <div class="myaccount-page-wrapper">
                    <!-- My Account Tab Menu Start -->
                    <div class="row">
                        <div class="col-lg-3">
                            <div class="myaccount-tab-menu nav" role="tablist">
                                <a href="#dashboad" class="active" data-toggle="tab"><i class="fa fa-dashboard"></i>
                                    基本信息</a>

                                <a href="#cart" data-toggle="tab"><i class="fa fa-cart-arrow-down"></i>购物车</a>

                                <a href="#orderList" data-toggle="tab"><i class="fa fa-cloud-download"></i>订单</a>

                                <!--<a href="#payment-method" data-toggle="tab"><i class="fa fa-credit-card"></i>支付方式</a>-->

                                <a href="#address-edit" data-toggle="tab"><i class="fa fa-map-marker"></i>收件信息</a>

                                <a href="#account-info" data-toggle="tab"><i class="fa fa-user"></i>账号 & 安全</a>

                                <a href="#" class="logout"><i class="fa fa-sign-out"></i>离开</a>
                            </div>
                        </div>
                        <!-- My Account Tab Menu End -->

                        <!-- My Account Tab Content Start -->
                        <div class="col-lg-9 mt-15 mt-lg-0">
                            <div class="tab-content" id="myaccountContent">
                                <!-- Single Tab Content Start -->
                                <div class="tab-pane fade show active" id="dashboad" role="tabpanel">
                                    <div class="myaccount-content">
                                        <h3>基本信息</h3>
                                        <p><strong >账号:</strong>&nbsp<span id="userAccount"></span></p>
                                        <p><strong>账号余额:</strong>&nbsp<span id="userMoney"></span></p>
                                        
                                    </div>
                                </div>
                                <!-- Single Tab Content End -->

                                <!-- Single Tab Content Start -->
                                <div class="tab-pane fade" id="orders" role="tabpanel">
                                    <div class="myaccount-content">
                                        <h3>全部商品</h3>

                                        <div class="myaccount-table table-responsive text-center">
                                            <table class="table table-bordered">
                                                <thead class="thead-light">
                                                    <tr>
                                                        <th>编号</th>
                                                        <th>商品</th>
                                                        <th>规格</th>
                                                        <th>单价</th>
                                                        <th>购买</th>
                                                    </tr>
                                                </thead>

                                                <tbody>
                                                    <tr>
                                                        <td>1</td>
                                                        <td>一加7T Pro（8GB/256GB/全网通）</td>
                                                        <td>幻夜黑</td>
                                                        <td>￥4499</td>
                                                        <td><a href="cart.html" class="btn">加入订单</a></td>
                                                    </tr>
                                                    <tr>
                                                        <td>2</td>
                                                        <td>一加7T Pro（8GB/256GB/全网通）</td>
                                                        <td>幻夜黑</td>
                                                        <td>￥4499</td>
                                                        <td><a href="cart.html" class="btn">加入订单</a></td>
                                                    </tr>
                                                    <tr>
                                                        <td>3</td>
                                                        <td>一加7T Pro（8GB/256GB/全网通）</td>
                                                        <td>幻夜黑</td>
                                                        <td>￥4499</td>
                                                        <td><a href="cart.html" class="btn">加入订单</a></td>
                                                    </tr>
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                </div>
                                <!-- Single Tab Content End -->

                                <!-- Single Tab Content Start -->
                                <!--<div class="tab-pane fade" id="download" role="tabpanel">-->
                                    <!--<div class="myaccount-content">-->
                                        <!--<h3>待付款</h3>-->

                                        <!--<div class="myaccount-table table-responsive text-center">-->
                                            <!--<table class="table table-bordered">-->
                                                <!--<thead class="thead-light">-->
                                                <!--<tr>-->
                                                    <!--<th>商品</th>-->
                                                    <!--<th>订单日期</th>-->
                                                    <!--<th>备注</th>-->
                                                    <!--<th>拍下商品</th>-->
                                                <!--</tr>-->
                                                <!--</thead>-->

                                                <!--<tbody>-->
                                                    <!--<tr>-->
                                                        <!--<td>一加7T Pro（8GB/256GB/全网通）</td>-->
                                                        <!--<td>2019.11.11</td>-->
                                                        <!--<td><input type="" placeholder="无"style="width: 50px;"></td>-->
                                                        <!--<td><a href="#" class="btn">结算订单</a></td>-->
                                                    <!--</tr>-->
                                                    <!--<tr>-->
                                                        <!--<td>一加7T Pro（8GB/256GB/全网通）</td>-->
                                                        <!--<td>2019.11.11</td>-->
                                                        <!--<td><input type="" placeholder="无"style="width: 50px;"></td>-->
                                                        <!--<td><a href="#" class="btn">结算订单</a></td>-->
                                                    <!--</tr>-->
                                                <!--</tbody>-->
                                            <!--</table>-->
                                        <!--</div>-->
                                    <!--</div>-->
                                <!--</div>-->
                                <!-- Single Tab Content End -->

                                <!-- Single Tab Content Start -->
                                <!--<div class="tab-pane fade" id="payment-method" role="tabpanel">-->
                                    <!--<div class="myaccount-content">-->
                                        <!--<h3>我的支付方式</h3>-->

                                        <!--<p class="saved-message">您还未添加任何支付方式 <a href="#"><span style="float: right;">+添加方式</span></a></p>-->
                                    <!--</div>-->
                                <!--</div>-->
                                <!-- Single Tab Content End -->

                                <!-- Single Tab Content Start -->
                                <div class="tab-pane fade" id="address-edit" role="tabpanel">
                                    <div class="myaccount-content">
                                        <h3>我的收件地址 <!-- <a href="#"><span style="float: right;">+添加新地址</span></a> --></h3>

                                        <address>
                                            <p><strong>收件人：<span id="receiver"></span></strong></p>
                                            <p><strong>收件地址：<span id="address"></span></strong></p>
                                        </address>

                                        <button id="edit-address-button" class="btn"><i class="fa fa-edit"></i>编辑地址</button>

                                        <div id="edit-address" class="row" style="display: none">
                                            <input class="form form-control text-center" name="address" style="font-size: 18px" type="text" placeholder="请输入详细的地址信息 省/市/区(县)/街道(村)/收件地址信息">
                                            <button class="btn mx-auto btn-danger" style="background-color: #dc3545">取消</button><button class="btn mx-auto btn-success">提交</button>
                                        </div>

                                    </div>
                                </div>

                                <div class="tab-pane fade" id="cart" role="tabpanel">

                                </div>

                                <div class="tab-pane fade" id="orderList" role="tabpanel">

                                </div>
                                <!-- Single Tab Content End -->

                                <!-- Single Tab Content Start -->
                                <div class="tab-pane fade" id="account-info" role="tabpanel">
                                    <div class="myaccount-content">
                                        <h3>用户信息</h3>

                                        <div class="account-details-form">
                                            <form action="#">
                                                <div class="row">
                                                    <div class="col-lg-6">
                                                        <div class="single-input-item">
                                                            <label for="first-name" class="required">姓</label>
                                                            <input type="text" id="first-name" placeholder="姓" />
                                                        </div>
                                                    </div>

                                                    <div class="col-lg-6">
                                                        <div class="single-input-item">
                                                            <label for="last-name" class="required">名</label>
                                                            <input type="text" id="last-name" placeholder="名" />
                                                        </div>
                                                    </div>
                                                </div>

                                                <!--<div class="single-input-item">-->
                                                    <!--<label for="display-name" class="required">昵称</label>-->
                                                    <!--<input type="text" id="display-name" placeholder="Display Name" />-->
                                                <!--</div>-->

                                                <div class="single-input-item">
                                                    <label for="email" class="required">邮箱</label>
                                                    <input type="email" id="email" placeholder="Email Address" />
                                                </div>

                                                <fieldset>
                                                    <legend>修改密码</legend>
                                                    <div class="single-input-item">
                                                        <label for="current-pwd" class="required">原密码</label>
                                                        <input type="password" id="current-pwd" placeholder="Current Password" />
                                                    </div>

                                                    <div class="row">
                                                        <div class="col-lg-6">
                                                            <div class="single-input-item">
                                                                <label for="new-pwd" class="required">新密码</label>
                                                                <input type="password" id="new-pwd" placeholder="New Password" />
                                                            </div>
                                                        </div>

                                                        <div class="col-lg-6">
                                                            <div class="single-input-item">
                                                                <label for="confirm-pwd" class="required">确认新密码</label>
                                                                <input type="password" id="confirm-pwd" placeholder="Confirm Password" />
                                                            </div>
                                                        </div>
                                                    </div>
                                                </fieldset>

                                                <div class="single-input-item">
                                                    <button class="btn" id="changeUser">确认修改</button>
                                                </div>


                                                <fieldset>
                                                    <legend>修改支付密码</legend>
                                                    <div class="single-input-item">
                                                        <label for="current-paypwd" class="required">原支付密码</label>
                                                        <input oninput="value=value.replace(/[^\d]/g,'')" type="password" maxlength="6"  minlength="6" id="current-paypwd" placeholder="Current Password" />
                                                    </div>

                                                    <div class="row">
                                                        <div class="col-lg-6">
                                                            <div class="single-input-item">
                                                                <label for="new-paypwd" class="required">新密码</label>
                                                                <input oninput="value=value.replace(/[^\d]/g,'')" type="password" maxlength="6"  minlength="6" id="new-paypwd" placeholder="New Password" />
                                                            </div>
                                                        </div>

                                                        <div class="col-lg-6">
                                                            <div class="single-input-item">
                                                                <label for="confirm-paypwd" class="required">确认新密码</label>
                                                                <input oninput="value=value.replace(/[^\d]/g,'')" type="password" maxlength="6"  minlength="6" id="confirm-paypwd" placeholder="Confirm Password" />
                                                            </div>
                                                        </div>
                                                    </div>
                                                </fieldset>

                                                <div class="single-input-item">
                                                    <button class="btn" id="changePayPasswd">确认修改</button>
                                                </div>
                                            </form>
                                        </div>
                                    </div>
                                </div>
                                <!-- Single Tab Content End -->
                            </div>
                        </div>
                        <!-- My Account Tab Content End -->
                    </div>
                </div>
                <!-- My Account Page End -->
            </div>
        </div>
    </div>
</div>
<!--== Page Content Wrapper End ==-->
<script src="./core/sha1.js"></script>
<script>
    $(document).ready(function () {
        $('#edit-address-button').on('click',function () {
            $('#edit-address').show()
            $('#edit-address-button').hide()
            $('#edit-address input').focus()
        })

        $('#edit-address .btn-success').on('click',function () {
            $('#edit-address').hide()
            $('#edit-address-button').show()
            $.ajax({
                url: './template/my.php',
                type: 'POST',
                dataType: 'json',
                data: {
                    'address': $('#edit-address input').val()
                },
                async: false,
                success: function  (data) {
                    if('Success' in data)
                    {
                        alert(data['Success'])
                        location.reload()
                    }
                    else
                    {
                        alert(data['Error'])
                    }
                }
            })
        })
        $('#edit-address .btn-danger').on('click',function () {
            $('#edit-address').hide()
            $('#edit-address-button').show()
        })
        $.ajax({
            url: './template/my.php',
            type: 'POST',
            dataType: 'json',
            data: {
                'user': ''
            },
            async: false,
            success: function  (data) {
                if('setPayPassword' in data)
                {
                    $('#current-paypwd').parent().hide()
                    $('.myaccount-tab-menu').children().removeClass('active')
                    $('.myaccount-tab-menu a[href="#account-info"]').addClass('active')
                    $('#myaccountContent').children().removeClass('active show').addClass('fade')
                    $('#account-info').removeClass('fade').addClass('active show')
                    alert('支付密码尚未设置\n请先到个人中心 => 账号 & 安全\n设置支付密码后才能使用交易功能')
                    $('#new-paypwd').focus()
                }
                else if(data[5] == null)
                {
                    $('#current-paypwd').parent().hide()
                    $('.myaccount-tab-menu').children().removeClass('active')
                    $('.myaccount-tab-menu a[href="#address-edit"]').addClass('active')
                    $('#myaccountContent').children().removeClass('active show').addClass('fade')
                    $('#address-edit').removeClass('fade').addClass('active show')
                    alert('收件地址尚未设置\n请先完善收件信息')
                }
                $('#userAccount').text(data[0])
                $('#userMoney').text(data[1])
                $('#first-name').val(data[2])
                $('#last-name').val(data[3])
                $('#email').val(data[4])

                $('#receiver').text(data[2] + data[3])

                $('#address').text(data[5])
            }
        })
        $('.logout').on('click',function () {
            $('#logout').click()
        })

        $('#changePayPasswd').on('click',function () {
            if($('#current-paypwd').parent().css('display') == 'none')
            {
                $('#current-paypwd').val('')
            }
            reg = /[^\d]/g
            if($('#new-paypwd').val() != $('#confirm-paypwd').val() || $('#confirm-paypwd').val().length != 6 || reg.test($('#confirm-paypwd').val()))
            {
                alert('请输入6位支付密码')
            }
            else {
                $.ajax({
                    url: './core/system.php',
                    type: 'POST',
                    dataType: 'json',
                    data: {
                        'changePayPassword': '',
                        'payPassword': $('#current-paypwd').val(),
                        'newPayPassword': $('#confirm-paypwd').val()
                    },
                    async: false,
                    success: function (data) {
                        for (x in data) {
                            alert(data[x])
                            location.reload()
                        }
                    }
                })
            }
        })


        $('#changeUser').on('click',function(){
            if(($('#first-name').val()!=''?true:false) && ($('#last-name').val()!=''?true:false) && ($('#email').val()!=''?true:false)){
                if($('#current-pwd').val()=='' || $('#new-pwd').val() == '' || $('#confirm-pwd').val() == '')
                {
                    $.ajax({
                        url:'./template/my.php',
                        type:'POST',
                        dataType:'json',
                        data:{
                            'changeUser':'',
                            'Fname':$('#first-name').val(),
                            'Lname':$('#last-name').val(),
                            'email':$('#email').val(),
                        },
                        async:false,
                        success:function (data) {
                            if('Error'in data)
                            {
                                alert(data['Error'])
                            }
                            else if('Success' in data){
                                alert(data['Success'])
                                location.reload()
                            }
                        }
                    })
                }
                else{
                    var passWordExp = /^(?=.*?[a-z])(?=.*?[A-Z])(?=.*?\d)(?=.*?[!@#$%^&*() `\/\-+]).*$/
                    if($('#new-pwd').val() != $('#confirm-pwd').val()){
                        alert('确认密码与新密码不一致');
                    }
                    else{
                        if($('#confirm-pwd').val().length < 6 || !passWordExp.test($('#confirm-pwd').val()))
                        {
                            alert('密码不符合强度要求');
                        }
                        else{
                            $.ajax({
                                url:'./template/my.php',
                                type:'POST',
                                dataType:'json',
                                data:{
                                    'changeUser':'',
                                    'Fname':$('#first-name').val(),
                                    'Lname':$('#last-name').val(),
                                    'email':$('#email').val(),
                                    'pwd':sha1($('#current-pwd').val()),
                                    'Npwd':sha1($('#confirm-pwd').val())
                                },
                                async:false,
                                success:function (data) {
                                    if('Error'in data)
                                    {
                                        alert(data['Error'])
                                    }
                                    else if('Success' in data){
                                        alert(data['Success'])
                                        location.reload()
                                    }
                                }
                            })
                        }
                    }
                }

            }
            else
            {
                alert('请检查信息是否填写完整')
            }

        })
    })

    $(document).ready(function () {
        $('a[href="#orderList"]').on('click',function () {
            $.ajax({
                url:'./template/my.php',
                type:'POST',
                data:{
                    'myOrderList':""
                },
                async:false,
                success:function (datas) {
                    contain = ''
                    for(data in datas){
                        contain += "<div style='margin-bottom: 10px'>" +
                            "<h4>订单号："+datas[data][0]+"</h4>" +
                            "<h4>商品名称：<a href='./product.php?pid="+datas[data][2]+"'>"+datas[data][1]+"</a></h4>" +
                            "<h4>收货地址："+datas[data][3]+"</h4>" +
                            "<h5>订单状态："+datas[data][4]+"</h5>" +
                            "<h5>支付方式："+datas[data][5]+"</h5>" +
                            "</div><hr/>"
                    }
                    $('#orderList').html(contain)
                }
            })
        })

        $('a[href="#cart"]').on('click', function () {
                $.ajax({
                    url: './cart.php',
                    type: 'POST',
                    data: {
                        'select': ''
                    },
                    async: false,
                    success: function (datas) {
                        contain = ''
                        var data = -1
                        for (data in datas) {
                            contain += '                                <!-- Single Cart Item Start -->\n' +
                                '                                <div class="single-cart-item d-flex">\n' +
                                '                                    <figure class="product-thumb">\n' +
                                '                                        <a href="product.php?pid='+datas[data][3]+'">\n' +
                                '                                            <img src="images/product/'+datas[data][3]+'/img.jpg" class="img-fluid" style="max-height: 100px;" alt="Products"/></a>\n' +
                                '                                    </figure>\n' +
                                '                                    <div class="product-details w-100 text-center">\n' +
                                '                                        <h2><a href="product.php?pid='+datas[data][3]+'">' + datas[data][0] + '</a></h2>\n' +
                                '                                        <div class="cal text-center align-items-center">\n' +
                                '                                            <span class="quantity">' + datas[data][1] + '</span>\n' +
                                '                                            <span class="multiplication">X</span>\n' +
                                '                                            <span class="price">' + datas[data][2] + '</span>\n' +
                                '                                        </div>\n' +
                                '                                    </div>\n' +
                                '                                    <a href="#" class="remove-icon" pid="' + datas[data][3] + '"><i class="fa fa-trash-o"></i></a>\n' +
                                '                                </div>\n' +
                                '                                <!-- Single Cart Item End -->'
                        }

                        $(document).ready(function () {
                            $('.remove-icon').on('click', function () {
                                $.ajax({
                                    url: './cart.php',
                                    type: 'POST',
                                    data: {
                                        'delete': $(this).attr('pid'),
                                    },
                                    async: false,
                                    success: function (datas) {
                                        if ('Error' in datas) {
                                            alert(datas['Error'])
                                        } else {
                                            contain = ''
                                            var data = -1
                                            for (data in datas) {
                                                contain += '                                <!-- Single Cart Item Start -->\n' +
                                                    '                                <div class="single-cart-item d-flex">\n' +
                                                    '                                    <figure class="product-thumb">\n' +
                                                    '                                        <a href="product.php?pid='+datas[data][3]+'">\n' +
                                                    '                                            <img src="images/product/'+datas[data][3]+'/img.jpg" class="img-fluid" style="max-height: 100px;" alt="Products"/></a>\n' +
                                                    '                                    </figure>\n' +
                                                    '                                    <div class="product-details w-100 text-center">\n' +
                                                    '                                        <h2><a href="product.php?pid='+datas[data][3]+'">' + datas[data][0] + '</a></h2>\n' +
                                                    '                                        <div class="cal text-center align-items-center">\n' +
                                                    '                                            <span class="quantity">' + datas[data][1] + '</span>\n' +
                                                    '                                            <span class="multiplication">X</span>\n' +
                                                    '                                            <span class="price">' + datas[data][2] + '</span>\n' +
                                                    '                                        </div>\n' +
                                                    '                                    </div>\n' +
                                                    '                                    <a href="#" class="remove-icon" pid="' + datas[data][3] + '"><i class="fa fa-trash-o"></i></a>\n' +
                                                    '                                </div>\n' +
                                                    '                                <!-- Single Cart Item End -->'
                                            }

                                            if (data > -1) {
                                                $('.cart-count').css({'display': 'inline-block'}).html(parseInt(data) + 1)
                                            } else {
                                                $('.cart-count').css({'display': 'none'})
                                                contain = '<div class="single-cart-item d-flex"><h4 class="text-center mx-auto text-dark">购物车内暂无商品</h4></div>'
                                            }
                                            $('#cart').html(contain)
                                        }
                                    }
                                })
                            })
                        })


                        if (data > -1) {
                            $('.cart-count').css({'display': 'inline-block'}).html(parseInt(data) + 1)
                        } else {
                            $('.cart-count').css({'display': 'none'})
                            contain = '<div class="single-cart-item d-flex"><h4 class="text-center mx-auto text-dark">购物车内暂无商品</h4></div>'
                        }
                        $('#cart').html(contain)
                    }
                })
        })


    })
</script>